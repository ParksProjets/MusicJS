function Knob(e,t){function f(n){var s=n.pageX-r.offset().left,o=n.pageY-r.offset().top;var u=Math.atan2(s-t.radius,t.radius-o)*180/Math.PI;if(u>135)u=135;else if(u<-135)u=-135;TweenMax.to(i,.4,{rotation:u});e.trigger("change",[t.min+(u+135)/270*(t.max-t.min)])}function l(e){f(e);$(window).bind("mousemove",f).bind("mouseup",c)}function c(){$(window).unbind("mousemove",f).unbind("mouseup",c)}var n=this;this.options=t;var r=$('<div class="wheelContainer"></div>'),i=$('<div class="wheel"></div>');r.append(i).css("width",t.radius*2+"px");i.css({width:t.radius*2+"px",height:t.radius*2+"px","border-radius":t.radius+"px"});var s=$("<div></div>");s.css({height:t.radius/2+"px"});i.append(s);var o=$('<div class="tige rt"></div>'),u=$('<div class="tige lt"></div>'),a=$('<div class="tige"></div>');o.css("top",t.radius*2-14+"px");u.css("top",t.radius*2-14+"px");r.append([o,u,a]);a.css({left:t.radius-1.5+"px",top:"-12px"});e.addClass("knob").append(r);i.append("<p>"+t.name+"</p>");this.$wheel=i;i.bind("mousedown",l)}function parseTime(e){var t=Math.floor(e/60),n=Math.floor(e-t*60);return(t<10?"0"+t:t)+":"+(n<10?"0"+n:n)}function resize(e){wHeight=$(window).height();wWidth=$(window).width()}function onKeyDown(e){if(e.keyCode==38){FFTManager.prev()}else if(e.keyCode==40){FFTManager.next()}else if(e.keyCode==32){$("#switch").trigger("click")}else if(e.keyCode==69){EQMenu.switch()}else if(e.keyCode==79){FFTMenu.switch()}else if(e.keyCode==77){MusicMenu.switch()}}function dancerUpdate(){$progress.css("left",dancer.getTime()*200/dancer.getDuration()+"px");$temps1.text(parseTime(dancer.getTime()))}function onMouseMove(e){if(Menu.opened&&e.pageX<wWidth-255)Menu.close();else if(!Menu.opened&&e.pageX>wWidth-80)Menu.open()}function readFile(e){var n=new FileReader;var r=e.name.substr(0,e.name.lastIndexOf("."))||e.name;var i=$("<div></div>"),s=$('<p class="del">x</p>'),o=$('<p class="name">'+r+"</p>"),u=$('<p class="duration"></p>');var a=$('<div class="loader1"></div>');for(var f=1;f<9;f++)a.append('<div class="rotateG_0'+f+'"></div>');$songsContainer.append(i.append([s,o,a,u]));n.onload=function(n){var r=n.target.result;adapter.context.decodeAudioData(r,function(t){var n=Player.playlist.add({name:e.name,buffer:t,elem:i});a.remove();u.text(parseTime(t.duration));i.click(function(){Player.play(n)})},function(e){i.remove();alert(t("incompatible file"))})};n.onerror=function(e){alert(t("cant read file"))};n.readAsArrayBuffer(e)}THREE.BloomPass=function(e,t,n,r){e=e!==undefined?e:1;t=t!==undefined?t:25;n=n!==undefined?n:4;r=r!==undefined?r:256;var i={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};this.renderTargetX=new THREE.WebGLRenderTarget(r,r,i);this.renderTargetY=new THREE.WebGLRenderTarget(r,r,i);if(THREE.CopyShader===undefined)console.error("THREE.BloomPass relies on THREE.CopyShader");var s=THREE.CopyShader;this.copyUniforms=THREE.UniformsUtils.clone(s.uniforms);this.copyUniforms["opacity"].value=e;this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,blending:THREE.AdditiveBlending,transparent:true});if(THREE.ConvolutionShader===undefined)console.error("THREE.BloomPass relies on THREE.ConvolutionShader");var o=THREE.ConvolutionShader;this.convolutionUniforms=THREE.UniformsUtils.clone(o.uniforms);this.convolutionUniforms["uImageIncrement"].value=THREE.BloomPass.blurx;this.convolutionUniforms["cKernel"].value=THREE.ConvolutionShader.buildKernel(n);this.materialConvolution=new THREE.ShaderMaterial({uniforms:this.convolutionUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,defines:{KERNEL_SIZE_FLOAT:t.toFixed(1),KERNEL_SIZE_INT:t.toFixed(0)}});this.enabled=true;this.needsSwap=false;this.clear=false};THREE.BloomPass.prototype={render:function(e,t,n,r,i){if(i)e.context.disable(e.context.STENCIL_TEST);THREE.EffectComposer.quad.material=this.materialConvolution;this.convolutionUniforms["tDiffuse"].value=n;this.convolutionUniforms["uImageIncrement"].value=THREE.BloomPass.blurX;e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,this.renderTargetX,true);this.convolutionUniforms["tDiffuse"].value=this.renderTargetX;this.convolutionUniforms["uImageIncrement"].value=THREE.BloomPass.blurY;e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,this.renderTargetY,true);THREE.EffectComposer.quad.material=this.materialCopy;this.copyUniforms["tDiffuse"].value=this.renderTargetY;if(i)e.context.enable(e.context.STENCIL_TEST);e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,n,this.clear)}};THREE.BloomPass.blurX=new THREE.Vector2(.001953125,0);THREE.BloomPass.blurY=new THREE.Vector2(0,.001953125);THREE.CopyShader={uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")};THREE.EffectComposer=function(e,t){this.renderer=e;if(t===undefined){var n=window.innerWidth||1;var r=window.innerHeight||1;var i={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:false};t=new THREE.WebGLRenderTarget(n,r,i)}this.renderTarget1=t;this.renderTarget2=t.clone();this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2;this.passes=[];if(THREE.CopyShader===undefined)console.error("THREE.EffectComposer relies on THREE.CopyShader");this.copyPass=new THREE.ShaderPass(THREE.CopyShader)};THREE.EffectComposer.prototype={swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer;this.writeBuffer=e},addPass:function(e){this.passes.push(e)},insertPass:function(e,t){this.passes.splice(t,0,e)},render:function(e){this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2;var t=false;var n,r,i=this.passes.length;for(r=0;r<i;r++){n=this.passes[r];if(!n.enabled)continue;n.render(this.renderer,this.writeBuffer,this.readBuffer,e,t);if(n.needsSwap){if(t){var s=this.renderer.context;s.stencilFunc(s.NOTEQUAL,1,4294967295);this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e);s.stencilFunc(s.EQUAL,1,4294967295)}this.swapBuffers()}if(n instanceof THREE.MaskPass){t=true}else if(n instanceof THREE.ClearMaskPass){t=false}}},reset:function(e){if(e===undefined){e=this.renderTarget1.clone();e.width=window.innerWidth;e.height=window.innerHeight}this.renderTarget1=e;this.renderTarget2=e.clone();this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2},setSize:function(e,t){var n=this.renderTarget1.clone();n.width=e;n.height=t;this.reset(n)}};THREE.EffectComposer.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1);THREE.EffectComposer.quad=new THREE.Mesh(new THREE.PlaneGeometry(2,2),null);THREE.EffectComposer.scene=new THREE.Scene;THREE.EffectComposer.scene.add(THREE.EffectComposer.quad);THREE.FilmPass=function(e,t,n,r){if(THREE.FilmShader===undefined)console.error("THREE.FilmPass relies on THREE.FilmShader");var i=THREE.FilmShader;this.uniforms=THREE.UniformsUtils.clone(i.uniforms);this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader});if(r!==undefined)this.uniforms.grayscale.value=r;if(e!==undefined)this.uniforms.nIntensity.value=e;if(t!==undefined)this.uniforms.sIntensity.value=t;if(n!==undefined)this.uniforms.sCount.value=n;this.enabled=true;this.renderToScreen=false;this.needsSwap=true};THREE.FilmPass.prototype={render:function(e,t,n,r){this.uniforms["tDiffuse"].value=n;this.uniforms["time"].value+=r;THREE.EffectComposer.quad.material=this.material;if(this.renderToScreen){e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera)}else{e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,t,false)}}};THREE.FocusShader={uniforms:{tDiffuse:{type:"t",value:null},screenWidth:{type:"f",value:1024},screenHeight:{type:"f",value:1024},sampleDistance:{type:"f",value:.94},waveFactor:{type:"f",value:.00125}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float screenWidth;","uniform float screenHeight;","uniform float sampleDistance;","uniform float waveFactor;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color, org, tmp, add;","float sample_dist, f;","vec2 vin;","vec2 uv = vUv;","add = color = org = texture2D( tDiffuse, uv );","vin = ( uv - vec2( 0.5 ) ) * vec2( 1.4 );","sample_dist = dot( vin, vin ) * 2.0;","f = ( waveFactor * 100.0 + sample_dist ) * sampleDistance * 4.0;","vec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2( f );","add += tmp = texture2D( tDiffuse, uv + vec2( 0.111964, 0.993712 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.846724, 0.532032 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.943883, -0.330279 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.330279, -0.943883 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.532032, -0.846724 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.993712, -0.111964 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.707107, 0.707107 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","color = color * vec4( 2.0 ) - ( add / vec4( 8.0 ) );","color = color + ( add / vec4( 8.0 ) - color ) * ( vec4( 1.0 ) - vec4( sample_dist * 0.5 ) );","gl_FragColor = vec4( color.rgb * color.rgb * vec3( 0.95 ) + color.rgb, 1.0 );","}"].join("\n")};THREE.MaskPass=function(e,t){this.scene=e;this.camera=t;this.enabled=true;this.clear=true;this.needsSwap=false;this.inverse=false};THREE.MaskPass.prototype={render:function(e,t,n,r){var i=e.context;i.colorMask(false,false,false,false);i.depthMask(false);var s,o;if(this.inverse){s=0;o=1}else{s=1;o=0}i.enable(i.STENCIL_TEST);i.stencilOp(i.REPLACE,i.REPLACE,i.REPLACE);i.stencilFunc(i.ALWAYS,s,4294967295);i.clearStencil(o);e.render(this.scene,this.camera,n,this.clear);e.render(this.scene,this.camera,t,this.clear);i.colorMask(true,true,true,true);i.depthMask(true);i.stencilFunc(i.EQUAL,1,4294967295);i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}};THREE.ClearMaskPass=function(){this.enabled=true};THREE.ClearMaskPass.prototype={render:function(e,t,n,r){var i=e.context;i.disable(i.STENCIL_TEST)}};THREE.FilmShader={uniforms:{tDiffuse:{type:"t",value:null},time:{type:"f",value:0},nIntensity:{type:"f",value:.5},sIntensity:{type:"f",value:.05},sCount:{type:"f",value:4096},grayscale:{type:"i",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float time;","uniform bool grayscale;","uniform float nIntensity;","uniform float sIntensity;","uniform float sCount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 cTextureScreen = texture2D( tDiffuse, vUv );","float x = vUv.x * vUv.y * time *  1000.0;","x = mod( x, 13.0 ) * mod( x, 123.0 );","float dx = mod( x, 0.01 );","vec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );","vec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );","cResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;","cResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );","if( grayscale ) {","cResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );","}","gl_FragColor =  vec4( cResult, cTextureScreen.a );","}"].join("\n")};THREE.HorizontalBlurShader={uniforms:{tDiffuse:{type:"t",value:null},h:{type:"f",value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")};THREE.ShaderPass=function(e,t){this.textureID=t!==undefined?t:"tDiffuse";this.uniforms=THREE.UniformsUtils.clone(e.uniforms);this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader});this.renderToScreen=false;this.enabled=true;this.needsSwap=true;this.clear=false};THREE.ShaderPass.prototype={render:function(e,t,n,r){if(this.uniforms[this.textureID]){this.uniforms[this.textureID].value=n}THREE.EffectComposer.quad.material=this.material;if(this.renderToScreen){e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera)}else{e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,t,this.clear)}}};THREE.RenderPass=function(e,t,n,r,i){this.scene=e;this.camera=t;this.overrideMaterial=n;this.clearColor=r;this.clearAlpha=i!==undefined?i:0;this.oldClearColor=new THREE.Color;this.oldClearAlpha=1;this.enabled=true;this.clear=true;this.needsSwap=false};THREE.RenderPass.prototype={render:function(e,t,n,r){this.scene.overrideMaterial=this.overrideMaterial;if(this.clearColor){this.oldClearColor.copy(e.getClearColor());this.oldClearAlpha=e.getClearAlpha();e.setClearColor(this.clearColor,this.clearAlpha)}e.render(this.scene,this.camera,n,this.clear);if(this.clearColor){e.setClearColor(this.oldClearColor,this.oldClearAlpha)}this.scene.overrideMaterial=null}};THREE.TriangleBlurShader={uniforms:{texture:{type:"t",value:null},delta:{type:"v2",value:new THREE.Vector2(1,1)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define ITERATIONS 10.0","uniform sampler2D texture;","uniform vec2 delta;","varying vec2 vUv;","float random( vec3 scale, float seed ) {","return fract( sin( dot( gl_FragCoord.xyz + seed, scale ) ) * 43758.5453 + seed );","}","void main() {","vec4 color = vec4( 0.0 );","float total = 0.0;","float offset = random( vec3( 12.9898, 78.233, 151.7182 ), 0.0 );","for ( float t = -ITERATIONS; t <= ITERATIONS; t ++ ) {","float percent = ( t + offset - 0.5 ) / ITERATIONS;","float weight = 1.0 - abs( percent );","color += texture2D( texture, vUv + delta * percent ) * weight;","total += weight;","}","gl_FragColor = color / total;","}"].join("\n")};THREE.VerticalBlurShader={uniforms:{tDiffuse:{type:"t",value:null},v:{type:"f",value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")};$.fn.knob=function(e,t){if(typeof e=="string"&&t===undefined){if(!$.data(this[0],"knob"))return null;return $.data(this[0],"knob").options[e]}if(typeof e=="string"&&t!==undefined){return this.each(function(n,r){var i=$.data(this,"knob");if(!i)return;i.changeOptions(e,t)})}e=$.extend({},$.fn.knob.defaults,e);return this.each(function(t,n){var r=$(this);if($.data(this,"knob"))return;var i=new Knob(r,e);$.data(this,"knob",i)})};$.fn.knob.defaults={radius:50,min:0,max:100,def:50,name:""};var ImprovedNoise=function(){function n(e){return e*e*e*(e*(e*6-15)+10)}function r(e,t,n){return t+e*(n-t)}function i(e,t,n,r){var i=e&15;var s=i<8?t:n,o=i<4?n:i==12||i==14?t:r;return((i&1)==0?s:-s)+((i&2)==0?o:-o)}var e=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];for(var t=0;t<256;t++){e[256+t]=e[t]}return{noise:function(t,s,o){var u=~~t,a=~~s,f=~~o;var l=u&255,c=a&255,h=f&255;t-=u;s-=a;o-=f;var d=t-1,v=s-1,m=o-1;var g=n(t),y=n(s),b=n(o);var w=e[l]+c,E=e[w]+h,S=e[w+1]+h,x=e[l+1]+c,T=e[x]+h,N=e[x+1]+h;return r(b,r(y,r(g,i(e[E],t,s,o),i(e[T],d,s,o)),r(g,i(e[S],t,v,o),i(e[N],d,v,o))),r(y,r(g,i(e[E+1],t,s,m),i(e[T+1],d,s,o-1)),r(g,i(e[S+1],t,v,m),i(e[N+1],d,v,m))))}}};var vendors=["ms","moz","webkit","o"];for(var x=0;x<vendors.length&&!window.requestAnimationFrame;++x){window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"]}Math.randIn=function(e,t){return Math.floor(Math.random()*(t-e+1)+e)};var language=navigator.browserLanguage||navigator.language;var Translation={};if(language.indexOf("fr")>-1)Translation.lang="fr";else Translation.lang="en";var t=Translation.get=function(e){return Translation[Translation.lang][e]||""};Translation["en"]={"incompatible file":"Sorry, this file is incompatible","cant read file":"Sorry, impossible to read this file","drop music here":"Drop your music files here","general options":"General options","show title":"Show title",none:"None",help:"Help and Infos",shortcuts:"Shortcuts",space:"Space",author:"Author",enabled:"Enabled",disenabled:"Disenabled"};Translation["fr"]={"incompatible file":"Désolé, ce fichier est imcompatible","cant read file":"Désolé, impossible de lire ce fichier","drop music here":"Déposez vos musiques ici","general options":"Options générales","show title":"Afficher le titre",none:"Aucune",help:"Aide et Infos",shortcuts:"Raccourcis",space:"Espace",author:"Auteur",enabled:"Activé",disenabled:"Désactivé"};$(".tr").each(function(){$(this).text(Translation.get($(this).text()))});(function(){function e(e,t){var n=[];var r=e.length;for(var i=0;i<r;){if(e[i]>t){n.push(i);i+=1e4}i++}return n}function t(e){var t=[];e.forEach(function(n,r){for(var i=0;i<10;i++){var s=e[r+i]-n;var o=t.some(function(e){if(e.interval===s)return e.count++});if(!o){t.push({interval:s,count:1,start:n})}}});return t}function n(e,t){var n=[];e.forEach(function(e,r){if(e.interval!==0){var i=60/(e.interval/t);while(i<90)i*=2;while(i>180)i/=2;i=Math.round(i);var s=n.some(function(t){if(t.tempo===i)return t.count+=e.count});if(!s){n.push({tempo:i,count:e.count,start:e.start})}}});return n}window.BeatDetector={};BeatDetector.run=function(r){if(typeof OfflineAudioContext=="undefined")return false;var i=new OfflineAudioContext(1,r.buffer.length,r.buffer.sampleRate);var s=i.createBufferSource();s.buffer=r.buffer;var o=i.createBiquadFilter();o.type="lowpass";s.connect(o);o.connect(i.destination);s.start(0);i.startRendering();i.oncomplete=function(i){var s=i.renderedBuffer;var o,u=.9,a=u,f=.3,l=30;do{o=e(i.renderedBuffer.getChannelData(0),a);a-=.05}while(o.length<l&&a>=f);var c=t(o);var h=n(c,s.sampleRate);if(h.length==0)return;var p=h.sort(function(e,t){return t.count-e.count}).splice(0,5);var d=60/p[0].tempo;r.bpm={tempo:p[0].tempo,dt:d,start:p[0].start/s.sampleRate%d}}}})();var wHeight=0,wWidth=0;$(window).resize(resize);resize();var Menus=[];Menus.hideAll=function(){for(var e=0;e<Menus.length;e++)Menus[e].hide()};var dancer=new Dancer,adapter=new Dancer.adapters.webaudiobuffer(dancer);dancer.audioAdapter=adapter;$(window).keydown(onKeyDown);var Player={};Player.current=0;Player.mode="next";Player.playlist=[];Player.playlist.get=function(e){return Player.playlist[(e||Player.current)-1]};Player.playlist.getNextIndex=function(){if(Player.current<Player.playlist.length)return Player.current+1;else return 0};Player.playlist.add=function(e){var t={fileName:e.name,name:e.name.substr(0,e.name.lastIndexOf("."))||e.name,buffer:e.buffer,elem:e.elem,bpm:null};BeatDetector.run(t);return Player.playlist.push(t)};Player.playlist.remove=function(e){return Player.playlist.slice(1,e)};Player.play=function(e){if(typeof e=="undefined"&&Player.current)return dancer.play();if(typeof e=="string"||!Player.current&&!e)e=1;Player.current=e;dancer.pause();dancer.setTime(0);adapter.buffer=Player.playlist[e-1].buffer;dancer.play()};Player.pause=function(){dancer.pause()};Player.stop=function(){dancer.pause();FFTManager.resetAll();dancer.setTime(0);dancer.trigger("pause")};Player.next=function(){if(Player.current<Player.playlist.length)Player.play(Player.current+1)};Player.last=function(){if(Player.current>1)Player.play(Player.current-1)};(function(){function s(){if(n)return;var t=Player.playlist.getNextIndex();if(!t)return;Player.current=t;var r=Player.playlist[t-1];var s=new Dancer.adapters.webaudiobuffer(dancer);s.buffer=r.buffer;s.eq.gain.gain.linearRampToValueAtTime(0,0);s.eq.gain.gain.linearRampToValueAtTime(1,e.time);adapter.eq.gain.gain.linearRampToValueAtTime(1,adapter.context.currentTime);adapter.eq.gain.gain.linearRampToValueAtTime(0,adapter.context.currentTime+e.time);s.play();adapter.dancer=i;n=adapter;adapter=s;dancer.audioAdapter=adapter;dancer.trigger("play")}function o(){if(!t)return;if(dancer.getDuration()-dancer.getTime()<=e.time)s()}var e=window.Player.Crossfade={};var t=false;e.time=5;var n=null;var r={};var i={trigger:function(e){r[e]&&r[e]()}};r.end=function(){n=null};e.on=function(){t=true};e.off=function(){t=false};e.on();dancer.bind("update",o)})();dancer.bind("end",function(){if(Player.mode=="next")Player.next()});var FFTManager=[];FFTManager.current=0;FFTManager.get=function(){return FFTManager[FFTManager.current]};FFTManager.set=function(e){if(e<0||e>=FFTManager.length)return;$("#fft"+FFTManager.current).hide();$("#fft"+e).show();if(FFTManager[FFTManager.current].off)FFTManager[FFTManager.current].off();if(FFTManager[e].on)FFTManager[e].on();FFTManager.current=e};FFTManager.prev=function(){FFTManager.set(FFTManager.current<=0?FFTManager.length-1:FFTManager.current-1)};FFTManager.next=function(){FFTManager.set(FFTManager.current>=FFTManager.length-1?0:FFTManager.current+1)};FFTManager.resetAll=function(){for(var e=0;e<FFTManager.length;e++){if(FFTManager[e].reset)FFTManager[e].reset()}};FFTManager.update=function(){FFTManager[FFTManager.current].update()};FFTManager.onPlay=function(){if(FFTManager[FFTManager.current].onPlay)FFTManager[FFTManager.current].onPlay()};FFTManager.onPause=function(){if(FFTManager[FFTManager.current].onPause)FFTManager[FFTManager.current].onPause()};FFTManager.onKick=function(){if(FFTManager[FFTManager.current].onKick)FFTManager[FFTManager.current].onKick()};FFTManager.offKick=function(){if(FFTManager[FFTManager.current].offKick)FFTManager[FFTManager.current].offKick()};FFTManager.onResize=function(){for(var e=0;e<FFTManager.length;e++){if(FFTManager[e].onResize)FFTManager[e].onResize(wHeight,wWidth)}};dancer.bind("update",FFTManager.update);dancer.bind("play",FFTManager.onPlay);dancer.bind("pause",FFTManager.onPause);$(window).resize(FFTManager.onResize);(function(){function i(){var e=Player.playlist.get();n=0;if(!e.bpm)return;n=e.bpm.dt;r=e.bpm.start;t=0}function s(){if(!e||!n)return;var i=dancer.getTime()+r;var s=Math.floor(i/n);if(s!=t){FFTManager.onKick();t=s}else{FFTManager.offKick()}}window.BPM={};var e=false,t=0,n,r;BPM.on=function(){e=true};BPM.off=function(){e=false};dancer.bind("play",i);dancer.bind("update",s)})();var Kick=dancer.createKick({onKick:FFTManager.onKick,offKick:FFTManager.offKick,decay:.02,threshold:.25,frequency:[0,10]}).on();(function(){function n(){e.children().remove();var n=FFTManager.get();if(!n.options){e.append($('<p class="info">'+t("none")+"</p>"));return}for(var r=0,i=n.options.length;r<i;r++){var s=n.options[r];switch(s.type){case"checkbox":var o=$('<input type="checkbox">');if(s.checked)o.attr("checked","true");o.change(function(){s.checked=$(this).is(":checked");s.onChange(s.checked)});e.append([o,$("<label>"+s.text+"</label>")]);break}}}function s(){o.hide()}$("input[type=radio][name=beat]").change(function(){Kick.off();BPM.off();if(this.value=="kick")Kick.on();else if(this.value=="beatdetector")BPM.on()});var e=$("#fftOptions");var r=$("#optionsFFT"),i=$("#btnFFT");r.mouseleave(s);i.click(function(){o.switch()});var o={isVisible:false,show:function(){Menus.hideAll();TweenMax.to(r,.5,{x:0});this.isVisible=true;n()},hide:function(){TweenMax.to(r,.5,{x:-260});this.isVisible=false},"switch":function(){if(this.isVisible)this.hide();else this.show()}};TweenMax.set(r,{x:-260,display:"block"});window.FFTMenu=o;Menus.push(o)})();(function(){function n(){r.hide()}$("#volume").knob({name:"Volume"}).change(function(e,t){adapter.eq.setGain(t)});$("#highGain").knob({name:"High"}).change(function(e,t){adapter.eq.setHighGain(t)});$("#midGain").knob({name:"Mid"}).change(function(e,t){adapter.eq.setMidGain(t)});$("#lowGain").knob({name:"Low"}).change(function(e,t){adapter.eq.setLowGain(t)});var e=$("#eq"),t=$("#btnEQ");e.mouseleave(n);t.click(function(){r.switch()});var r={isVisible:false,show:function(){Menus.hideAll();TweenMax.to(e,.5,{x:0});this.isVisible=true},hide:function(){TweenMax.to(e,.5,{x:-260});this.isVisible=false},"switch":function(){if(this.isVisible)this.hide();else this.show()}};TweenMax.set(e,{x:-260,display:"block"});window.EQMenu=r;Menus.push(r)})();(function(){function s(){if(adapter.audioNode)adapter.audioNode.playbackRate.value=e.currentTempo;adapter.lastPlaybackRate=e.currentTempo;}function o(){e.hide()}var e={};var t=$("#musicMenu"),n=$("#btnMusic");var r=$("#musicTempo"),i=$("input[type=radio][name=crossfade]");e.currentTempo=1;dancer.bind("play",s);r.change(function(){e.currentTempo=parseFloat($(this).val());s()});i.change(function(){if(this.value=="true")Player.Crossfade.on();else Player.Crossfade.off()});t.mouseleave(o);n.click(function(){e.switch()});e.isVisible=false;e.show=function(){Menus.hideAll();TweenMax.to(t,.5,{x:0});this.isVisible=true};e.hide=function(){TweenMax.to(t,.5,{x:-260});this.isVisible=false;r.blur()};e.switch=function(){if(this.isVisible)this.hide();else this.show()};TweenMax.set(t,{x:-260,display:"block"});window.MusicMenu=e;Menus.push(e)})();(function(){function n(){r.hide()}var e=$("#help"),t=$("#helpBtn");e.mouseleave(n);t.click(function(){r.switch()});var r={isVisible:false,show:function(){Menus.hideAll();TweenMax.to(e,.5,{x:0});this.isVisible=true},hide:function(){TweenMax.to(e,.5,{x:-260});this.isVisible=false},"switch":function(){if(this.isVisible)this.hide();else this.show()}};TweenMax.set(e,{x:-260,display:"block"});window.HelpMenu=r;Menus.push(r)})();dancer.bind("end",function(){FFTManager.resetAll();dancerUpdate()});var $progress=$("#progress div"),$temps1=$("#temps span:eq(0)"),$temps2=$("#temps span:eq(1)");var timer=null;$("#switch").click(function(){if(dancer.isPlaying())Player.pause();else Player.play()});$("#progress").click(function(e){dancer.setTime((e.pageX-$(this).offset().left)*dancer.getDuration()/200);dancerUpdate()});$("#stop").click(Player.stop);$("#next").click(Player.next);$("#last").click(Player.last);dancer.bind("play",function(){$("#play").hide();$("#pause").show();timer=setInterval(dancerUpdate,1e3/30);$temps2.text(parseTime(dancer.getDuration()))});dancer.bind("pause",function(){$("#pause").hide();$("#play").show();clearInterval(timer);dancerUpdate()});var menuOpened=false;var Menu={opened:false,open:function(){$("#menu").css("right",0);Menu.opened=true},close:function(){$("#menu").css("right","-260px");Menu.opened=false}};$("#params").hover(function(){$("#menu .contents").css("top",-$(this).height()+19+"px")},function(){$("#menu .contents").css("top",0)});var dragging=0,$dropHelp=$("#dropMusic");$(window).bind("dragenter",function(e){e.preventDefault();e.stopPropagation();dragging++;if(dragging==1)$dropHelp.fadeIn()});$(window).bind("dragleave",function(e){e.preventDefault();e.stopPropagation();dragging--;if(dragging==0)$dropHelp.fadeOut()});$(window).bind("dragover",function(e){e.preventDefault();e.stopPropagation()});window.addEventListener("drop",function(e){e.preventDefault();e.stopPropagation();for(var t=0;t<e.dataTransfer.files.length;t++)readFile(e.dataTransfer.files[t]);$dropHelp.fadeOut();Menu.open();setTimeout(function(){$(window).mousemove(onMouseMove)},2e3);dragging=0},false);$songsContainer=$("#songs");$dropHelp.fadeIn();(function(){function l(e){f=e;if(e)u.add(a).fadeIn();else u.add(a).fadeOut()}function c(){var e=Player.playlist.get();u.text(e.name);if(e.bpm)a.text(e.bpm.tempo+" BPM");else a.empty()}var e=$("#fft0 canvas")[0],n=e.getContext("2d");n.fillStyle="#666666";var r=0,i=0;var s=0,o=400;var u=$("#fft0Title"),a=$("#fft0BPM"),f=true;var h={onPlay:function(){c();if(f)u.add(a).fadeIn()},on:function(){c();if(dancer.isPlaying()&&f)u.add(a).show()},onKick:function(){n.fillStyle="#ff0077"},offKick:function(){n.fillStyle="#666666"},update:function(){var e=dancer.getSpectrum(),t=i*.9/(o-s),u=r*.95*1.5,a=i*.05,f=r*.95;n.clearRect(0,0,i,r);for(var l=s,c=e.length;l<c&&l<o;l++){n.fillRect(a+(l-s)*t,f,t,-e[l]*u)}},onResize:function(t,n){e.height=r=t;e.width=i=n;h.reset()},reset:function(){n.fillStyle="#666666";n.clearRect(0,0,i,r);if(!dancer.isPlaying())u.add(a).fadeOut()}};h.options=[{type:"checkbox",text:t("show title"),onChange:l,checked:true}];h.onResize(wHeight,wWidth);FFTManager[0]=h})();(function(){function p(){u=new THREE.PerspectiveCamera(30,1,1,1e4);u.position.z=2200;a=new THREE.Scene;a.fog=new THREE.Fog(16777215,2e3,1e4);a.add(u);var e=new THREE.DirectionalLight(15463423,1.6);e.position.set(0,140,500).multiplyScalar(1.1);a.add(e);var e=new THREE.DirectionalLight(4816659,1);e.position.set(0,-1,0);a.add(e);f=new THREE.WebGLRenderer({antialias:true});f.domElement.style.position="absolute";f.setClearColor(0,1);$("#fft1")[0].appendChild(f.domElement);var t=new THREE.ShaderPass(THREE.HorizontalBlurShader);t.uniforms["h"].value=1/window.innerWidth;var n=new THREE.ShaderPass(THREE.VerticalBlurShader);n.uniforms["v"].value=1/window.innerHeight;var r=15/window.innerWidth,i=THREE.TriangleBlurShader,s=new THREE.ShaderPass(i,"texture");s.uniforms["delta"].value=new THREE.Vector2(r,0);var o=new THREE.ShaderPass(THREE.FocusShader);o.uniforms["sampleDistance"].value=.99;o.uniforms["waveFactor"].value=.003;var c=new THREE.RenderPass(a,u);l=new THREE.EffectComposer(f);l.addPass(c);l.addPass(t);l.addPass(n);l.addPass(s);l.addPass(o);n.renderToScreen=true;o.renderToScreen=true;var h=new THREE.JSONLoader;h.load("asset/model4.js",d)}function d(e,t){var r=0,i=-250,o=-300;e.computeBoundingBox();var u=e.boundingBox;c=new THREE.SkinnedMesh(e,new THREE.MeshFaceMaterial(t));c.position.set(r,i-u.min.y*s,o);c.rotation.y=Math.PI*2;c.scale.set(s,s,s);a.add(c);n=true;v()}function v(){if(!n)return;c.scale.set(s,s,s);if(s<360)s=350;else s-=10;if(Math.abs(u.position.x)>600)r=-r;if(Math.abs(u.position.y)>500)i=-i;u.position.x+=r;u.position.y+=i;u.lookAt(a.position);l.render(.1);if(!o)return;requestAnimationFrame(v)}var e=$("#fft1 canvas")[0],t=e.getContext("2d");h=0,w=0,countFft=150;t.fillStyle="#ff0077";var n=false;var r=15;var i=7;var s=350;var o=false;var u,a,f,l,c;p();var m={onKick:function(){s=500},offKick:function(){},update:function(){var e=dancer.getSpectrum(),n=w*.42,r=h/countFft;t.clearRect(0,0,w,h);t.fillStyle="#666";for(var i=0,s=e.length;i<s&&i<countFft;i++){t.fillRect(0,i*r,e[i]*n,r);t.fillRect(w,i*r,-e[i]*n,r)}},onResize:function(t,n){u.aspect=n/t;u.updateProjectionMatrix();f.setSize(n,t);e.height=h=t;e.width=w=n;m.reset()},reset:function(){t.clearRect(0,0,w,h)},on:function(){o=true;requestAnimationFrame(v)},off:function(){o=false}};m.onResize(wHeight,wWidth);FFTManager[1]=m})();(function(){function c(){f++;if(f>a)f=1;n.fadeOut();n.attr("src","asset/img"+f+".jpg")}function h(e){if(e.keyCode==39||e.keyCode==37)c()}function p(){u=u>=2?0:u+1/60;t.clearRect(0,0,40,40);t.fillStyle="#E67D7D";t.beginPath();t.arc(20,20,10,0,2*Math.PI);t.fill();t.lineWidth=2;t.strokeStyle="#E67D7D";t.beginPath();t.arc(20,20,13,u*Math.PI,u*Math.PI+3*Math.PI/4);t.stroke();t.beginPath();t.arc(20,20,13,u*Math.PI+Math.PI,u*Math.PI+7*Math.PI/4);t.stroke();i.css("left",dancer.getTime()*700/dancer.getDuration()+"px");s.text(parseTime(dancer.getTime()));o.text(parseTime(dancer.getDuration()-dancer.getTime()));if(l)requestAnimationFrame(p)}var e=$("#fft2 canvas")[0],t=e.getContext("2d");var n=$("#fft2 img"),r=$("#fft2Progress"),i=$("#fft2Point"),s=$("#fft2TimeElapsed"),o=$("#fft2TimeLeft");var u=0,a=2,f=Math.randIn(0,a-1),l=false;r.click(function(e){dancer.setTime((e.pageX-$(this).offset().left)*dancer.getDuration()/700)});n.load(function(){if(!this.complete||typeof this.naturalWidth=="undefined"||this.naturalWidth==0){console.log("Invalid image: img"+index+".jpg");c()}else{n.fadeIn()}});c();p();var d={onPlay:function(){l=true;requestAnimationFrame(p)},onPause:function(){l=false;cancelAnimationFrame(p)},on:function(){$(window).bind("keydown",h);l=dancer.isPlaying();requestAnimationFrame(p)},off:function(){$(window).unbind("keydown",h);l=false},update:function(){},onResize:function(e,t){d.reset()},reset:function(){}};d.onResize(wHeight,wWidth);FFTManager[2]=d})();(function(){function E(e){w=e.clientX-wWidth/2;mouseY=e.clientY-wHeight/2}function S(){g=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,1,1e6);g.position.z=2e3;y=new THREE.Scene;y.add(g);b=new THREE.WebGLRenderer({antialias:false,sortObjects:false});b.setClearColor(0,1);$("#fft3")[0].appendChild(b.domElement);var e=new THREE.Shape;e.absarc(0,0,i,0,Math.PI*2,false);c=e.createPointsGeometry(s/2);c.dynamic=true;y.add(l);var t=1;for(var r=0;r<n;r++){var o=new THREE.LineBasicMaterial({color:16777215,linewidth:1,opacity:.7,blending:THREE.AdditiveBlending,depthTest:false,transparent:true});var h=new THREE.Line(c,o);u.push(h);t*=1.05;h.scale.x=t;h.scale.y=t;l.add(h);a.push(0);f.push(0)}x()}function x(){l.scale.x=l.scale.y=m.scale;var e=1;for(var t=0;t<n;t++){var r=u[t];r.scale.x=e;r.scale.y=e;e*=1+m.separation}}function T(){t.getByteFrequencyData(h);t.getByteTimeDomainData(p);var r=0;for(var i=0;i<o;i++){r+=h[i]}var E=r/o;var S=E/256*m.gain*2;a.push(S);a.shift(1);var x=Math.abs(d.noise(v,0,0));f.push(x);f.shift(1);for(var N=0;N<s;N++){c.vertices[N].z=p[N]*2}c.vertices[s].z=c.vertices[0].z;c.verticesNeedUpdate=true;for(i=0;i<n;i++){var C=n-i-1;var k=a[C]+.01;var L=f[i];u[i].material.color.setHSL(L,1,k*.8);u[i].material.linewidth=k*3;u[i].material.opacity=k;u[i].scale.z=k*m.zbounce}v+=.005;var A=w/wWidth*Math.PI*.3+Math.PI;var O=mouseY/wHeight*Math.PI*.4+Math.PI*1.3;l.rotation.x+=(-O-l.rotation.x)*.3;l.rotation.y+=(A-l.rotation.y)*.3;b.render(y,g);if(e)requestAnimationFrame(T)}function N(){t=dancer.audioAdapter.analyser;h=new Uint8Array(t.frequencyBinCount);p=new Uint8Array(t.frequencyBinCount)}var e=true;var t=null;var n=160;var r=30;var i=50;var s=512;var o=512;var u=[];var a=[];var f=[];var l=new THREE.Object3D;var c;var h;var p;var d=new ImprovedNoise;var v=Math.random()*100;var m={gain:1,separation:.05,scale:1,zbounce:1};var g,y,b;var w=mouseY=0;$(document).mousemove(E);S();var C={onPlay:N,update:function(){},onResize:function(e,t){g.aspect=t/e;g.updateProjectionMatrix();b.setSize(t,e);C.reset()},reset:function(){},on:function(){N();e=true;requestAnimationFrame(T)},off:function(){e=false}};C.onResize(wHeight,wWidth);FFTManager[3]=C})()